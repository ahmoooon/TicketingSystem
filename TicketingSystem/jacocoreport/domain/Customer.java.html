<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>Customer.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">JaCoCo Coverage Report</a> &gt; <a href="index.source.html" class="el_package">domain</a> &gt; <span class="el_source">Customer.java</span></div><h1>Customer.java</h1><pre class="source lang-java linenums">/*
 * Click nbfs://nbhost/SystemFileSystem/Templates/Licenses/license-default.txt to change this license
 * Click nbfs://nbhost/SystemFileSystem/Templates/Classes/Class.java to edit this template
 */
package domain;

/**
 *
 * @author Cason Soh
 */
// Customer.java - Domain/Data Layer
// NOTE: This class holds the HASHED password in the 'password' field.

import application.utilities.LoggerSetup;
import java.util.logging.Level;
import java.util.logging.Logger;

public class Customer { 
    // Match your original variable names
    private String name;
    private String password; // Stores the HASHED password
    private int id;
    
    // Match your original static counter logic
<span class="fc" id="L25">    private static int assignid = 1; // Start at 1 instead of 0001 for int type</span>

    // Empty Constructor (Updated to increment ID if used, matching original)
<span class="nc" id="L28">    public Customer() {</span>
<span class="nc" id="L29">        assignid++;</span>
<span class="nc" id="L30">    }</span>

    // Main Constructor (Accepts HASHED password from AuthService)
<span class="fc" id="L33">    public Customer(String name, String hashedPassword) {</span>
<span class="fc" id="L34">        this.name = name;</span>
<span class="fc" id="L35">        this.password = hashedPassword;</span>
        // Match your original ID assignment logic
<span class="fc" id="L37">        id = assignid; </span>
<span class="fc" id="L38">        assignid++;</span>
<span class="fc" id="L39">    }</span>
    
    // --- Getters (Matching Original Names) ---
    
    public String getName() { 
<span class="fc" id="L44">        return name; </span>
    }

    // IMPORTANT: This returns the HASHED password for internal use (e.g., AuthService verification)
    public String getPassword() { 
<span class="fc" id="L49">        return password; </span>
    }
    
    public int getId(){
<span class="nc" id="L53">        return id;</span>
    }

    // --- Setters (Matching Original Names) ---

    public void setName(String name) { 
<span class="nc" id="L59">        this.name = name; </span>
<span class="nc" id="L60">    }</span>

    // WARNING: This setter should only be called by the system to set the HASHED password
    public void setPassword(String hashedPassword) { 
<span class="nc" id="L64">        this.password = hashedPassword; </span>
<span class="nc" id="L65">    }</span>

    // --- JSON Conversion Methods (Updated to use original variable names) ---
    
    /**
     * Converts the Customer object to a single-line JSON string.
     * @return 
     */
    public String toJsonString() {
<span class="nc" id="L74">        return String.format(</span>
            &quot;{\&quot;name\&quot;:\&quot;%s\&quot;, \&quot;password\&quot;:\&quot;%s\&quot;, \&quot;id\&quot;:%d, \&quot;assignid\&quot;:%d}&quot;, 
            this.name, 
            this.password,
<span class="nc" id="L78">            this.id,</span>
<span class="nc" id="L79">            assignid // Include static counter value for persistence</span>
        );
    }
    
    /**
     * Parses a JSON string back into a Customer object.NOTE: This manual parsing is highly brittle and for demonstration only.
     * @param json
     * @return 
     */
    public static Customer fromJsonString(String json) {
<span class="nc" id="L89">        Logger logger = LoggerSetup.getLogger();</span>
        try {
            // Find the values by parsing the string based on known keys (Hashed password is found first)
<span class="nc" id="L92">            int passStart = json.indexOf(&quot;\&quot;password\&quot;:\&quot;&quot;) + 12;</span>
<span class="nc" id="L93">            int passEnd = json.indexOf(&quot;\&quot;, \&quot;id\&quot;:&quot;);</span>
<span class="nc" id="L94">            String password = json.substring(passStart, passEnd);</span>
            
<span class="nc" id="L96">            int nameStart = json.indexOf(&quot;\&quot;name\&quot;:\&quot;&quot;) + 8;</span>
<span class="nc" id="L97">            int nameEnd = json.indexOf(&quot;\&quot;, \&quot;password\&quot;:&quot;);</span>
<span class="nc" id="L98">            String name = json.substring(nameStart, nameEnd);</span>
            
            // Extract the ID and static assignid value
<span class="nc" id="L101">            int idStart = json.indexOf(&quot;\&quot;id\&quot;:&quot;) + 5;</span>
<span class="nc" id="L102">            int idEnd = json.indexOf(&quot;, \&quot;assignid\&quot;:&quot;);</span>
<span class="nc" id="L103">            int id = Integer.parseInt(json.substring(idStart, idEnd));</span>
            
<span class="nc" id="L105">            int assignidStart = json.indexOf(&quot;\&quot;assignid\&quot;:&quot;) + 11;</span>
<span class="nc" id="L106">            int assignidValue = Integer.parseInt(json.substring(assignidStart, json.lastIndexOf(&quot;}&quot;)));</span>
            
            // Set the static counter to the highest value found across all loaded customers
<span class="nc" id="L109">            Customer.assignid = Math.max(Customer.assignid, assignidValue);</span>

            // Manually create the customer object and set the ID, bypassing the constructor's increment
<span class="nc" id="L112">            Customer c = new Customer(name, password);</span>
<span class="nc" id="L113">            c.id = id; // Override the ID assigned by the constructor</span>
            
<span class="nc" id="L115">            return c;</span>
<span class="nc" id="L116">        } catch (NumberFormatException e) {</span>
<span class="nc" id="L117">            logger.log(Level.SEVERE, &quot;Failed to parse JSON string: {0}. Error: {1}&quot;, new Object[]{json, e.getMessage()});</span>
<span class="nc" id="L118">            return null;</span>
        }
    }

    // --- Standard Java Methods ---
    
    @Override
    public String toString() {
<span class="nc" id="L126">        return name + &quot; | &quot; + password + &quot; | ID: &quot; + id;</span>
    }
    
    // Removed cusLogin() and cusReg() methods, as their logic is now correctly placed in AuthService.
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.14.202510111229</span></div></body></html>